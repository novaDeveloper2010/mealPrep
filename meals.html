<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Meal Schedule Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-main: #0d1117;
            --bg-container: #161b22;
            --bg-card: #1c2128;
            --bg-card-hover: #252b33;
            --accent-green: #4ade80;
            --accent-green-dim: #22c55e;
            --text-white: #e6edf3;
            --text-gray: #8b949e;
            --text-muted: #6e7681;
            --border-color: #30363d;
            --border-green: #4ade80;
            --shadow-color: rgba(0, 0, 0, 0.4);
            --pill-bg: rgba(74, 222, 128, 0.1);
            --pill-text: #4ade80;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-main);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .container {
            max-width: 1400px;
            width: 100%;
            background: var(--bg-container);
            border-radius: 16px;
            box-shadow: 0 8px 32px var(--shadow-color);
            border: 1px solid var(--border-color);
            padding: 30px;
            position: relative;
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.2s ease;
            z-index: 100;
        }

        .theme-toggle:hover {
            border-color: var(--accent-green);
            background: var(--bg-card-hover);
        }

        /* Light theme variables */
        [data-theme="light"] {
            --bg-main: #f5f5f5;
            --bg-container: #ffffff;
            --bg-card: #f8f9fa;
            --bg-card-hover: #e9ecef;
            --accent-green: #22c55e;
            --accent-green-dim: #16a34a;
            --text-white: #1a1a2e;
            --text-gray: #4a5568;
            --text-muted: #718096;
            --border-color: #e2e8f0;
            --border-green: #22c55e;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --pill-bg: rgba(34, 197, 94, 0.1);
            --pill-text: #16a34a;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .header h1 {
            color: var(--text-white);
            font-size: 2em;
            margin-bottom: 8px;
            font-weight: 600;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .header h1::before {
            content: '';
            display: inline-block;
            width: 24px;
            height: 24px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%234ade80'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 6v6m0 0v6m0-6h6m-6 0H6'/%3E%3C/svg%3E");
        }

        .header p {
            color: var(--text-gray);
            font-size: 1.1em;
            font-weight: 400;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-card);
            color: var(--text-white);
        }

        .btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-green);
        }

        .btn-primary {
            background: var(--accent-green-dim);
            border-color: var(--accent-green-dim);
            color: #000;
        }

        .btn-primary:hover {
            background: var(--accent-green);
            border-color: var(--accent-green);
        }

        .btn-secondary {
            background: transparent;
            border-color: var(--border-color);
            color: var(--text-white);
        }

        .btn-secondary:hover {
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        .btn-outside {
            background: transparent;
            border-color: var(--border-color);
            color: var(--text-white);
        }

        .btn-outside:hover {
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        .week-info {
            display: none;
        }

        .schedule-container {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        @media (max-width: 1100px) {
            .schedule-container {
                flex-direction: column;
            }
        }

        .weekdays-section, .weekend-section {
            flex: 1;
        }

        .section-header {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .weekdays-header {
            background: rgba(76, 175, 80, 0.1);
            color: #2E7D32;
            border: 2px solid rgba(76, 175, 80, 0.2);
        }

        .weekend-header {
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.1) 0%, rgba(156, 39, 176, 0.1) 100%);
            color: #C2185B;
            border: 2px solid rgba(233, 30, 99, 0.2);
        }

        .main-content {
            display: flex;
            gap: 25px;
        }

        .meals-section {
            flex: 1;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .day-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-color);
            cursor: pointer;
        }

        .day-card:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-green);
        }

        .day-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: transparent;
            transition: background 0.2s ease;
        }

        /* Today's card - highlighted with green left border */
        .day-card.today {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
        }

        .day-card.today::before {
            background: var(--accent-green);
        }

        .day-card.today::after {
            content: "TODAY";
            position: absolute;
            top: 15px;
            right: 90px;
            background: var(--accent-green);
            color: #000;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 0.65em;
            font-weight: 700;
            letter-spacing: 0.5px;
            z-index: 10;
        }

        .day-card.today:hover {
            background: var(--bg-card-hover);
        }

        .day-card.today .day-name {
            color: var(--accent-green);
            font-weight: 600;
        }

        .day-card.today .meal-name {
            color: var(--text-white);
        }

        /* Lock button styling */
        .lock-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .lock-btn:hover {
            border-color: var(--accent-green);
            background: var(--bg-card-hover);
        }

        .lock-btn.locked {
            background: #f59e0b;
            border-color: #f59e0b;
        }

        .day-card.locked {
            border-color: #f59e0b;
        }

        .day-card.locked::before {
            background: #f59e0b;
        }

        .day-card.locked::after {
            display: none;
        }

        .day-card.today.locked::after {
            display: none;
        }

        /* Substitute button styling */
        .substitute-btn {
            position: absolute;
            top: 15px;
            right: 50px;
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .substitute-btn:hover {
            border-color: var(--accent-green);
            background: var(--bg-card-hover);
        }

        /* Substitute Modal */
        .substitute-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .substitute-modal.show {
            display: flex;
        }

        .substitute-content {
            background: var(--bg-container);
            border-radius: 12px;
            padding: 25px;
            max-width: 700px;
            width: 95%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--border-color);
        }

        .meal-options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        @media (max-width: 600px) {
            .meal-options-grid {
                grid-template-columns: 1fr;
            }
        }

        .order-food-option {
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px dashed var(--border-color);
            margin-bottom: 15px;
            background: transparent;
            color: var(--text-gray);
            font-size: 0.95em;
            font-weight: 500;
        }

        .order-food-option:hover {
            border-color: var(--accent-green);
            color: var(--accent-green);
            background: var(--pill-bg);
        }

        /* Restaurant/Eating Out card styling */
        .day-card.eating-out {
            border-color: #f59e0b;
        }

        .day-card.eating-out::before {
            background: #f59e0b;
        }

        .meal-type.eating-out {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
        }

        .substitute-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .substitute-header h3 {
            color: var(--text-white);
            font-size: 1.2em;
            margin: 0;
        }

        .substitute-close {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            font-size: 1.2em;
            cursor: pointer;
            color: var(--text-gray);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .substitute-close:hover {
            background: var(--bg-card-hover);
            color: var(--text-white);
            border-color: var(--accent-green);
        }

        .meal-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--border-color);
            margin-bottom: 8px;
            background: var(--bg-card);
        }

        .meal-option:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-green);
        }

        .meal-option.current {
            background: var(--pill-bg);
            border-color: var(--accent-green);
        }

        .meal-option-image {
            width: 50px;
            height: 50px;
            border-radius: 6px;
            object-fit: cover;
        }

        .meal-option-info {
            flex: 1;
        }

        .meal-option-name {
            font-weight: 600;
            color: var(--text-white);
            margin-bottom: 3px;
            font-size: 0.9em;
        }

        .meal-option-desc {
            font-size: 0.75em;
            color: var(--text-gray);
        }

        /* Weekend card styling - same as regular cards in dark theme */
        .weekend-section .day-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
        }

        .weekend-section .day-card:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-green);
        }

        .weekend-section .day-card::before {
            background: transparent;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .day-name {
            font-size: 1.1em;
            font-weight: 500;
            color: var(--accent-green);
        }

        .weekend-section .day-name {
            color: var(--accent-green);
        }

        .day-icon {
            display: none;
        }

        .weekend-section .day-icon {
            display: none;
        }

        .meal-type {
            display: inline-block;
            padding: 4px 10px;
            background: var(--pill-bg);
            border-radius: 4px;
            font-size: 0.75em;
            color: var(--pill-text);
            font-weight: 500;
        }

        .weekend-section .meal-type {
            background: var(--pill-bg);
            color: var(--pill-text);
        }

        .restaurant-order {
            background: linear-gradient(to right, #E91E63, #F06292);
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(233, 30, 99, 0.2);
        }

        .meal-name {
            font-size: 1em;
            color: var(--text-white);
            margin: 10px 0 6px;
            font-weight: 600;
            line-height: 1.3;
        }

        .weekend-section .meal-name {
            color: var(--text-white);
        }

        .meal-description {
            font-size: 0.8em;
            color: var(--text-gray);
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .weekend-section .meal-description {
            color: var(--text-gray);
        }

        .meal-details {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            font-size: 0.75em;
            flex-wrap: wrap;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 4px;
            background: var(--pill-bg);
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: 500;
            color: var(--pill-text);
        }

        .detail-item .detail-icon {
            font-size: 0.9em;
        }

        .weekend-section .detail-item {
            background: var(--pill-bg);
            color: var(--pill-text);
        }

        .weekend-section .detail-icon {
            color: var(--pill-text);
        }

        .click-details {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-top: 12px;
            padding: 8px 12px;
            background: var(--bg-card-hover);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.75em;
            color: var(--text-gray);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .click-details:hover {
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: var(--accent-green);
            font-size: 1.1em;
            font-weight: 500;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            display: inline-block;
            width: 36px;
            height: 36px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--accent-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(74, 222, 128, 0); }
        }

        .meal-image {
            width: 100%;
            height: 140px;
            border-radius: 8px;
            object-fit: cover;
            border: 1px solid var(--border-color);
        }

        .meal-image.error {
            display: none;
        }

        .image-placeholder {
            width: 100%;
            height: 140px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--bg-card-hover);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            color: var(--accent-green);
            position: relative;
            overflow: hidden;
        }

        .weekend-section .image-placeholder {
            background: var(--bg-card-hover);
            color: var(--accent-green);
        }

        .image-placeholder::after {
            display: none;
        }

        .weekend-section .image-placeholder::after {
            display: none;
        }

        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: var(--text-gray);
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px dashed var(--border-color);
        }

        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 20px;
            opacity: 0.7;
        }

        .empty-state h3 {
            color: var(--text-white);
            font-size: 1.3em;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .empty-state p {
            font-size: 0.95em;
            max-width: 400px;
            margin: 0 auto;
            line-height: 1.5;
        }

        /* Quick Links Panel */
        .quick-links-panel {
            width: 280px;
            flex-shrink: 0;
        }

        .quick-links-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .quick-links-card h3 {
            color: var(--text-white);
            font-size: 1em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .quick-link-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            color: var(--text-gray);
            font-size: 0.9em;
            cursor: pointer;
            transition: color 0.2s ease;
            border-bottom: 1px solid var(--border-color);
        }

        .quick-link-item:last-child {
            border-bottom: none;
        }

        .quick-link-item:hover {
            color: var(--accent-green);
        }

        .progress-section h3 {
            color: var(--text-white);
            font-size: 1em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .progress-label {
            color: var(--text-gray);
            font-size: 0.85em;
        }

        .progress-count {
            color: var(--text-white);
            font-size: 0.85em;
        }

        .progress-bar {
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-green);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .progress-info {
            color: var(--text-muted);
            font-size: 0.75em;
        }

        @media (max-width: 1000px) {
            .main-content {
                flex-direction: column;
            }
            .quick-links-panel {
                width: 100%;
                display: flex;
                gap: 20px;
            }
            .quick-links-card {
                flex: 1;
            }
        }

        .grocery-list {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .grocery-list h3 {
            color: var(--text-white);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1em;
            font-weight: 600;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .grocery-list ul {
            list-style: none;
            columns: 2;
            column-gap: 20px;
        }

        .grocery-list li {
            padding: 8px 0;
            color: var(--text-gray);
            font-weight: 400;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
            break-inside: avoid;
        }

        .grocery-list li::before {
            content: '‚Ä¢';
            color: var(--accent-green);
            font-size: 1.2em;
        }

        .restaurant-list {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .restaurant-list h3 {
            color: var(--text-white);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1em;
            font-weight: 600;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .restaurant-list p {
            color: var(--accent-green);
            font-size: 1em;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .restaurant-list ul {
            list-style: none;
            columns: 2;
            column-gap: 20px;
        }

        .restaurant-list li {
            padding: 8px 0;
            color: var(--text-gray);
            font-weight: 400;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
            break-inside: avoid;
        }

        .restaurant-list li::before {
            content: '‚Ä¢';
            color: var(--accent-green);
            font-size: 1.2em;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
        }

        .modal-overlay.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-container);
            border-radius: 12px;
            padding: 25px;
            max-width: 450px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--border-color);
            color: var(--text-white);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            font-size: 1.2em;
            cursor: pointer;
            color: var(--text-gray);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--bg-card-hover);
            color: var(--text-white);
            border-color: var(--accent-green);
        }

        .modal-header {
            margin-bottom: 20px;
            padding-right: 40px;
        }

        .modal-title {
            font-size: 1.4em;
            color: var(--text-white);
            margin-bottom: 5px;
            font-weight: 600;
        }

        .modal-subtitle {
            color: var(--text-gray);
            font-size: 0.9em;
            font-weight: 400;
        }

        .modal-section {
            margin-bottom: 20px;
        }

        .modal-section h4 {
            color: var(--accent-green);
            font-size: 1em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .ingredients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 8px;
        }

        .ingredient-item {
            background: var(--pill-bg);
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 0.8em;
            color: var(--pill-text);
            text-align: center;
            font-weight: 500;
        }

        .cost-comparison {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-card);
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
        }

        .cost-comparison span {
            color: var(--text-gray);
            font-size: 0.85em;
        }

        .cost-bar {
            flex: 1;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }

        .cost-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .cost-low { background: var(--accent-green); }
        .cost-medium { background: #f59e0b; }
        .cost-medium-high { background: #f97316; }
        .cost-high { background: #ef4444; }

        .cost-legend {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 12px;
            font-size: 0.75em;
            flex-wrap: wrap;
            color: var(--text-gray);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 500;
            font-size: 0.8em;
        }

        .difficulty-easy { background: var(--pill-bg); color: var(--pill-text); }
        .difficulty-medium { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }

        @media (max-width: 768px) {
            .schedule-container {
                flex-direction: column;
            }

            .ingredients-grid {
                grid-template-columns: 1fr;
            }

            .cost-legend {
                flex-direction: column;
                align-items: center;
            }
        }

        /* Password Protection Overlay */
        .password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .password-overlay.hidden {
            display: none;
        }

        .password-box {
            background: var(--bg-container);
            padding: 35px;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            text-align: center;
            max-width: 380px;
            width: 90%;
            border: 1px solid var(--border-color);
        }

        .password-box h2 {
            color: var(--text-white);
            margin-bottom: 8px;
            font-size: 1.4em;
        }

        .password-box p {
            color: var(--text-gray);
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .password-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 12px;
            transition: border-color 0.2s;
            background: var(--bg-card);
            color: var(--text-white);
        }

        .password-input:focus {
            outline: none;
            border-color: var(--accent-green);
        }

        .password-input.error {
            border-color: #ef4444;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .password-submit {
            width: 100%;
            padding: 12px;
            background: var(--accent-green-dim);
            color: #000;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .password-submit:hover {
            background: var(--accent-green);
        }

        .password-error {
            color: #ef4444;
            margin-top: 12px;
            display: none;
            font-size: 0.9em;
        }

        .password-error.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Password Protection Overlay -->
    <div class="password-overlay hidden" id="passwordOverlay">
        <div class="password-box">
            <h2>Generate New Schedule</h2>
            <p>Enter password to regenerate the weekly schedule</p>
            <input type="password" class="password-input" id="passwordInput" placeholder="Password" onkeypress="if(event.key==='Enter')checkPassword()">
            <button class="password-submit" onclick="checkPassword()">Enter</button>
            <p class="password-error" id="passwordError">Incorrect password. Try again.</p>
        </div>
    </div>

    <div class="container" id="mainContainer">
        <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle dark/light mode">
            üåô
        </button>
        <div class="header">
            <h1>WEEKLY MEAL PLANNER</h1>
            <p>Week <span id="weekNumber">1</span>: <span id="dateRange">Nov 17 - Nov 23</span></p>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="promptPasswordForNewSchedule()">
                Generate New Schedule
            </button>
            <button class="btn btn-secondary" onclick="showGroceryList()">
                View Grocery List
            </button>
            <button class="btn btn-outside" onclick="randomOrderOut()">
                Order Out Tonight!
            </button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Creating your delicious meal schedule...</p>
        </div>

        <div class="main-content">
            <div class="meals-section">
                <div id="scheduleContent">
                    <div class="empty-state">
                        <div class="empty-state-icon">üç≥</div>
                        <h3>No schedule yet!</h3>
                        <p>Click "Generate New Schedule" to create your weekly meal plan.</p>
                    </div>
                </div>

                <div class="grocery-list" id="groceryList" style="display: none;">
                    <h3>Weekly Grocery List</h3>
                    <ul id="groceryItems"></ul>
                </div>

                <div class="restaurant-list" id="restaurantList" style="display: none;">
                    <h3>Restaurant Order</h3>
                    <p id="restaurantChoice">Click "Order Out Tonight!" to randomly select a restaurant!</p>
                    <ul id="restaurantItems"></ul>
                </div>
            </div>

            <div class="quick-links-panel">
                <div class="quick-links-card">
                    <h3>Quick Links</h3>
                    <div class="quick-link-item" onclick="scrollToToday()">
                        <span>üçΩÔ∏è</span> Today's Meal
                    </div>
                    <div class="quick-link-item" onclick="showGroceryList()">
                        <span>üõí</span> View Grocery List
                    </div>
                    <div class="quick-link-item" onclick="randomOrderOut()">
                        <span>üè™</span> Order Out Tonight!
                    </div>
                </div>

                <div class="quick-links-card progress-section">
                    <h3>Progress</h3>
                    <div class="progress-header">
                        <span class="progress-label">Total Progress</span>
                        <span class="progress-count" id="progressCount">0 / 14</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="progress-info" id="progressInfo">0 / 14 meals planned</div>
                </div>
            </div>
        </div>

        <!-- Meal Details Modal -->
        <div class="modal-overlay" id="mealModal">
            <div class="modal-content">
                <button class="modal-close" onclick="closeMealModal()">&times;</button>
                <div class="modal-header">
                    <div class="modal-title" id="modalTitle"></div>
                    <div class="modal-subtitle" id="modalSubtitle"></div>
                </div>
                
                <div class="modal-section">
                    <h4>üìù Ingredients</h4>
                    <div class="ingredients-grid" id="ingredientsList"></div>
                </div>

                <div class="modal-section">
                    <h4>üìä Difficulty & Cost</h4>
                    <div id="difficultyDisplay"></div>
                    
                    <div class="cost-comparison">
                        <span>Cost Level:</span>
                        <div class="cost-bar">
                            <div class="cost-fill" id="costBar"></div>
                        </div>
                        <span id="costText"></span>
                    </div>
                    
                    <div class="cost-legend">
                        <div class="legend-item">
                            <div class="legend-color cost-low"></div>
                            <span>$ Low</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color cost-medium"></div>
                            <span>$$ Medium</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color cost-medium-high"></div>
                            <span>$$$ Med-High</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color cost-high"></div>
                            <span>$$$$ High</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Substitute Meal Modal -->
        <div class="substitute-modal" id="substituteModal">
            <div class="substitute-content">
                <div class="substitute-header">
                    <h3>Substitute Meal for <span id="substituteDayName"></span></h3>
                    <button class="substitute-close" onclick="closeSubstituteModal()">&times;</button>
                </div>
                <div id="mealOptionsList"></div>
            </div>
        </div>
    </div>

    <!-- Load configuration files -->
    <script src="password-config.js"></script>
    <script src="meals-config.js"></script>
    <script src="meals-images.js"></script>
    <script src="restaurants-config.js"></script>
    <script src="restaurants-images.js"></script>
    <script>
        // Password protection - only for generating new schedule
        function checkPassword() {
            const input = document.getElementById('passwordInput');
            const error = document.getElementById('passwordError');

            if (input.value === PASSWORD_CONFIG.password) {
                // Correct password - generate new schedule
                document.getElementById('passwordOverlay').classList.add('hidden');
                error.classList.remove('show');
                input.value = '';
                // Actually generate the new schedule
                doGenerateNewSchedule();
            } else {
                // Wrong password
                input.classList.add('error');
                error.classList.add('show');
                setTimeout(() => input.classList.remove('error'), 500);
            }
        }

        // Show password prompt for new schedule generation
        function promptPasswordForNewSchedule() {
            if (!PASSWORD_CONFIG.enabled) {
                // Password protection disabled, generate directly
                doGenerateNewSchedule();
                return;
            }
            document.getElementById('passwordOverlay').classList.remove('hidden');
            document.getElementById('passwordInput').focus();
        }

        // Close password overlay when clicking outside
        document.getElementById('passwordOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordError').classList.remove('show');
            }
        });
    </script>
    <script>
        // Theme Toggle Functionality
        function toggleTheme() {
            const html = document.documentElement;
            const themeToggle = document.getElementById('themeToggle');
            const currentTheme = html.getAttribute('data-theme');

            if (currentTheme === 'light') {
                html.removeAttribute('data-theme');
                themeToggle.textContent = 'üåô';
                localStorage.setItem('theme', 'dark');
            } else {
                html.setAttribute('data-theme', 'light');
                themeToggle.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'light');
            }
        }

        // Load saved theme on page load
        (function() {
            const savedTheme = localStorage.getItem('theme');
            const themeToggle = document.getElementById('themeToggle');

            if (savedTheme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
                if (themeToggle) themeToggle.textContent = '‚òÄÔ∏è';
            }
        })();
    </script>
    <script>
        // Build allMeals array with images from meals-images.js
        const allMeals = mealsConfig.map(meal => ({
            ...meal,
            localImage: mealImages[meal.name] || '',
            image: `https://source.unsplash.com/400x300/?${encodeURIComponent(meal.name)},food`
        }));

        // Build groceryDatabase from config
        const groceryDatabase = {};
        mealsConfig.forEach(meal => {
            if (meal.ingredients) {
                groceryDatabase[meal.name] = meal.ingredients;
            }
        });

        // Use restaurants from config
        const restaurantOptions = restaurantsConfig;

        let currentWeek = 1;
        let currentSchedule = null;

        // Locked meals: stores {day: meal} for days that are locked
        let lockedMeals = JSON.parse(localStorage.getItem('lockedMeals') || '{}');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            updateWeekInfo();
            generateSchedule(); // Load cached schedule or generate if none
        });

        // Toggle lock for a specific day
        function toggleLock(day, event) {
            event.stopPropagation(); // Prevent card click

            if (lockedMeals[day]) {
                // Unlock
                delete lockedMeals[day];
            } else {
                // Lock current meal for this day
                lockedMeals[day] = currentSchedule[day];
            }

            // Save to localStorage
            localStorage.setItem('lockedMeals', JSON.stringify(lockedMeals));

            // Re-display schedule with updated lock states
            displaySchedule(currentSchedule);
            saveScheduleToCache();
        }

        // Substitute meal modal
        let substituteDay = null;

        let showingRestaurants = false;

        function openSubstituteModal(day, dayName, event) {
            event.stopPropagation();
            substituteDay = day;
            showingRestaurants = false;
            document.getElementById('substituteDayName').textContent = dayName;
            renderMealOptions();
            document.getElementById('substituteModal').classList.add('show');
        }

        function renderMealOptions() {
            const currentMealName = currentSchedule[substituteDay]?.name;
            const isCurrentlyRestaurant = currentSchedule[substituteDay]?.isRestaurant;
            const optionsList = document.getElementById('mealOptionsList');
            optionsList.innerHTML = '';

            // Add order food option at the top
            const orderDiv = document.createElement('div');
            orderDiv.className = 'order-food-option';
            orderDiv.onclick = () => {
                showingRestaurants = true;
                renderRestaurantOptions();
            };
            orderDiv.innerHTML = `<span>üè™</span> Order Food Instead - Click to choose restaurant`;
            optionsList.appendChild(orderDiv);

            // Create grid container for meals
            const gridDiv = document.createElement('div');
            gridDiv.className = 'meal-options-grid';

            allMeals.forEach(meal => {
                const isCurrent = meal.name === currentMealName && !isCurrentlyRestaurant;
                const div = document.createElement('div');
                div.className = `meal-option ${isCurrent ? 'current' : ''}`;
                div.onclick = () => selectSubstituteMeal(meal);
                div.innerHTML = `
                    <img src="${meal.localImage || meal.image}" class="meal-option-image"
                         onerror="this.src='${meal.image}'">
                    <div class="meal-option-info">
                        <div class="meal-option-name">${meal.name} ${isCurrent ? '(current)' : ''}</div>
                        <div class="meal-option-desc">${meal.desc}</div>
                    </div>
                `;
                gridDiv.appendChild(div);
            });

            optionsList.appendChild(gridDiv);
        }

        function renderRestaurantOptions() {
            const currentRestaurantName = currentSchedule[substituteDay]?.name;
            const isCurrentlyRestaurant = currentSchedule[substituteDay]?.isRestaurant;
            const optionsList = document.getElementById('mealOptionsList');
            optionsList.innerHTML = '';

            // Add back to meals option
            const backDiv = document.createElement('div');
            backDiv.className = 'order-food-option';
            backDiv.onclick = () => {
                showingRestaurants = false;
                renderMealOptions();
            };
            backDiv.innerHTML = `<span>üçΩÔ∏è</span> Back to Home Meals`;
            optionsList.appendChild(backDiv);

            // Create grid container for restaurants
            const gridDiv = document.createElement('div');
            gridDiv.className = 'meal-options-grid';

            restaurantsConfig.forEach(restaurant => {
                const isCurrent = restaurant.name === currentRestaurantName && isCurrentlyRestaurant;
                const restaurantImage = restaurantImages[restaurant.name] || '';
                const div = document.createElement('div');
                div.className = `meal-option ${isCurrent ? 'current' : ''}`;
                div.onclick = () => selectRestaurant(restaurant);
                div.innerHTML = `
                    <div class="meal-option-image" style="display: flex; align-items: center; justify-content: center; background: var(--bg-card-hover); font-size: 2em;">
                        ${restaurantImage ? `<img src="${restaurantImage}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 6px;" onerror="this.parentElement.innerHTML='${restaurant.emoji}'">` : restaurant.emoji}
                    </div>
                    <div class="meal-option-info">
                        <div class="meal-option-name">${restaurant.name} ${isCurrent ? '(current)' : ''}</div>
                        <div class="meal-option-desc">${restaurant.desc}</div>
                    </div>
                `;
                gridDiv.appendChild(div);
            });

            optionsList.appendChild(gridDiv);
        }

        function selectRestaurant(restaurant) {
            if (substituteDay && currentSchedule) {
                // Create a restaurant entry that looks like a meal
                const restaurantMeal = {
                    name: restaurant.name,
                    desc: restaurant.desc,
                    type: "Eating Out",
                    emoji: restaurant.emoji,
                    time: "0 min",
                    difficulty: "Easy",
                    cost: "medium",
                    ingredients: restaurant.items,
                    isRestaurant: true,
                    localImage: restaurantImages[restaurant.name] || '',
                    image: ''
                };

                currentSchedule[substituteDay] = restaurantMeal;

                // If this day was locked, update the locked meal too
                if (lockedMeals[substituteDay]) {
                    lockedMeals[substituteDay] = restaurantMeal;
                    localStorage.setItem('lockedMeals', JSON.stringify(lockedMeals));
                }

                displaySchedule(currentSchedule);
                saveScheduleToCache();
                closeSubstituteModal();
            }
        }

        function closeSubstituteModal() {
            document.getElementById('substituteModal').classList.remove('show');
            substituteDay = null;
        }

        function selectSubstituteMeal(meal) {
            if (substituteDay && currentSchedule) {
                currentSchedule[substituteDay] = meal;

                // If this day was locked, update the locked meal too
                if (lockedMeals[substituteDay]) {
                    lockedMeals[substituteDay] = meal;
                    localStorage.setItem('lockedMeals', JSON.stringify(lockedMeals));
                }

                displaySchedule(currentSchedule);
                saveScheduleToCache();
                closeSubstituteModal();
            }
        }

        // Close substitute modal when clicking outside
        document.getElementById('substituteModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSubstituteModal();
            }
        });

        // Week caching functions
        function getWeekNumber() {
            const now = new Date();
            const start = new Date(now.getFullYear(), 0, 1);
            const diff = now - start;
            const oneWeek = 604800000; // milliseconds in a week
            return Math.floor(diff / oneWeek);
        }

        function saveScheduleToCache() {
            const cacheData = {
                week: getWeekNumber(),
                year: new Date().getFullYear(),
                schedule: currentSchedule
            };
            localStorage.setItem('cachedSchedule', JSON.stringify(cacheData));
        }

        function loadScheduleFromCache() {
            try {
                const cached = JSON.parse(localStorage.getItem('cachedSchedule'));
                if (cached && cached.week === getWeekNumber() && cached.year === new Date().getFullYear()) {
                    return cached.schedule;
                }
            } catch (e) {
                console.error('Error loading cached schedule:', e);
            }
            return null;
        }

        function updateWeekInfo() {
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay()); // Sunday

            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6); // Saturday

            const options = { month: 'short', day: 'numeric' };
            const dateRange = `${startOfWeek.toLocaleDateString('en-US', options)} - ${endOfWeek.toLocaleDateString('en-US', options)}`;

            document.getElementById('weekNumber').textContent = currentWeek;
            document.getElementById('dateRange').textContent = dateRange;
        }

        function scrollToToday() {
            const todayCard = document.querySelector('.day-card.today');
            if (todayCard) {
                todayCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                todayCard.style.animation = 'pulse 0.5s ease';
                setTimeout(() => todayCard.style.animation = '', 500);
            }
        }

        function updateProgress() {
            if (currentSchedule) {
                const totalMeals = Object.keys(currentSchedule).length;
                const plannedMeals = totalMeals;
                const percentage = (plannedMeals / 14) * 100;

                document.getElementById('progressCount').textContent = `${plannedMeals} / 14`;
                document.getElementById('progressFill').style.width = `${percentage}%`;
                document.getElementById('progressInfo').textContent = `${plannedMeals} / 14 meals planned`;
            }
        }

        // Pick n random unique meals, excluding certain meal names
        function getRandomMeals(count, excludeNames = []) {
            const available = allMeals.filter(meal => !excludeNames.includes(meal.name));
            const shuffled = [...available].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }

        // Load schedule from cache or generate new if no cache exists
        function generateSchedule() {
            // Try to load from cache first
            const cachedSchedule = loadScheduleFromCache();
            if (cachedSchedule) {
                currentSchedule = cachedSchedule;
                displaySchedule(cachedSchedule);
                return;
            }
            // No cache, generate new schedule
            doGenerateNewSchedule();
        }

        // Generate a completely new schedule (called after password verification)
        function doGenerateNewSchedule() {
            const loading = document.getElementById('loading');
            const scheduleContent = document.getElementById('scheduleContent');

            // Hide restaurant list when generating new schedule
            document.getElementById('restaurantList').style.display = 'none';

            // Show loading state
            loading.classList.add('show');
            scheduleContent.innerHTML = '';

            // Simulate API delay for better UX
            setTimeout(() => {
                const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];

                // Get names of locked meals to exclude from random selection
                const lockedMealNames = Object.values(lockedMeals).map(meal => meal.name);

                // Count how many days need random meals
                const unlockedDays = days.filter(day => !lockedMeals[day]);
                const randomMeals = getRandomMeals(unlockedDays.length, lockedMealNames);

                // Build schedule: use locked meals or pick from random
                const schedule = {};
                let randomIndex = 0;
                days.forEach(day => {
                    if (lockedMeals[day]) {
                        schedule[day] = lockedMeals[day];
                    } else {
                        schedule[day] = randomMeals[randomIndex++];
                    }
                });

                currentSchedule = schedule;
                displaySchedule(schedule);
                saveScheduleToCache();

                // Hide loading state
                loading.classList.remove('show');

                // Increment week
                currentWeek++;
                updateWeekInfo();
            }, 1000);
        }

        function displaySchedule(schedule) {
            const scheduleContent = document.getElementById('scheduleContent');
            const baseDays = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            const baseDayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

            // Get today's day index (0 = Sunday, 1 = Monday, etc.)
            const todayIndex = new Date().getDay();

            // Reorder arrays to start from today
            const days = [];
            const dayNames = [];
            for (let i = 0; i < 7; i++) {
                const idx = (todayIndex + i) % 7;
                days.push(baseDays[idx]);
                dayNames.push(baseDayNames[idx]);
            }

            let html = '<div class="schedule-grid" style="max-width: 100%;">';

            days.forEach((day, index) => {
                const meal = schedule[day];
                const originalDay = baseDays[(todayIndex + index) % 7]; // Get the actual day name for locking
                const isToday = index === 0; // First card is always today
                const isLocked = !!lockedMeals[originalDay];
                const isEatingOut = meal.isRestaurant || meal.type === 'Eating Out';

                html += `
                    <div class="day-card fade-in ${isToday ? 'today' : ''} ${isLocked ? 'locked' : ''} ${isEatingOut ? 'eating-out' : ''}"
                         style="animation-delay: ${index * 0.1}s"
                         onclick="showMealDetails('${meal.name}', '${meal.desc}', '${meal.time}', '${meal.difficulty}', '${meal.cost}', '${meal.emoji}')">
                        <button class="lock-btn ${isLocked ? 'locked' : ''}"
                                onclick="toggleLock('${originalDay}', event)"
                                title="${isLocked ? 'Unlock this meal' : 'Lock this meal'}">
                            ${isLocked ? 'üîí' : 'üîì'}
                        </button>
                        <button class="substitute-btn"
                                onclick="openSubstituteModal('${originalDay}', '${dayNames[index]}', event)"
                                title="Substitute this meal">
                            üîÑ
                        </button>
                        <div class="day-header">
                            <div class="day-name">
                                ${dayNames[index]}
                            </div>
                            <span class="meal-type ${isEatingOut ? 'eating-out' : ''}">${meal.type}</span>
                        </div>

                        ${isEatingOut ? `
                        <div class="meal-image" style="display: flex; align-items: center; justify-content: center; background: var(--bg-card-hover);">
                            ${meal.localImage ? `<img src="${meal.localImage}" alt="${meal.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;"
                                 onerror="this.parentElement.innerHTML='<span style=\\'font-size: 3em;\\'>${meal.emoji}</span>'">` : `<span style="font-size: 3em;">${meal.emoji}</span>`}
                        </div>
                        ` : `
                        <img src="${meal.localImage}"
                             data-fallback="${meal.image}"
                             alt="${meal.name}"
                             class="meal-image"
                             onerror="handleImageError(this, '${meal.emoji}', '${meal.name}')">`}

                        <div class="meal-name">${meal.name}</div>
                        <div class="meal-description">${meal.desc}</div>

                        <div class="meal-details">
                            <div class="detail-item">
                                <span class="detail-icon">‚è±Ô∏è</span>
                                ${meal.time}
                            </div>
                            <div class="detail-item">
                                <span class="detail-icon">üë®‚Äçüç≥</span>
                                ${meal.difficulty}
                            </div>
                            <div class="detail-item" style="background: rgba(255,152,0,0.15);">
                                <span class="detail-icon">üí∞</span>
                                ${getCostEmoji(meal.cost)} ${capitalizeFirst(meal.cost)}
                            </div>
                        </div>

                        <div class="click-details">
                            <span>‚ÑπÔ∏è</span> Click for details
                        </div>
                    </div>
                `;
            });

            html += '</div>';

            scheduleContent.innerHTML = html;

            // Hide grocery list when showing new schedule
            document.getElementById('groceryList').style.display = 'none';

            // Update progress bar
            updateProgress();
        }

        function getCostEmoji(cost) {
            const costMap = {
                'low': '$',
                'medium': '$$',
                'medium-high': '$$$',
                'high': '$$$$'
            };
            return costMap[cost] || '$';
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // Two-tier image error handler: tries local, then Unsplash, then placeholder
        window.handleImageError = function(img, emoji, name) {
            // If we haven't tried the fallback (Unsplash) yet
            if (img.src !== img.dataset.fallback && img.dataset.fallback) {
                img.src = img.dataset.fallback; // Try Unsplash next
            } else {
                // Both local and Unsplash failed, show placeholder
                img.style.display = 'none';
                
                // Create placeholder element
                const placeholder = document.createElement('div');
                placeholder.className = 'image-placeholder';
                placeholder.innerHTML = `
                    <div style="font-size: 0.9rem; color: #388E3C; background: rgba(255,255,255,0.8); padding: 4px 12px; border-radius: 20px; position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);">
                        ${name}
                    </div>
                    <div style="font-size: 3em; margin-bottom: 10px;">${emoji}</div>
                `;
                
                // Insert after the image
                img.parentNode.insertBefore(placeholder, img.nextSibling);
            }
        };

        function showMealDetails(name, desc, time, difficulty, cost, emoji) {
            const modal = document.getElementById('mealModal');
            const ingredients = groceryDatabase[name] || [];
            
            // Set modal content
            document.getElementById('modalTitle').textContent = `${emoji} ${name}`;
            document.getElementById('modalSubtitle').textContent = desc;
            
            // Display ingredients
            const ingredientsList = document.getElementById('ingredientsList');
            ingredientsList.innerHTML = '';
            ingredients.forEach(ingredient => {
                const div = document.createElement('div');
                div.className = 'ingredient-item';
                div.textContent = ingredient;
                ingredientsList.appendChild(div);
            });
            
            // Display difficulty
            const difficultyDisplay = document.getElementById('difficultyDisplay');
            difficultyDisplay.innerHTML = `
                <div style="margin-bottom: 10px;">Difficulty: <span class="difficulty-badge difficulty-${difficulty.toLowerCase()}">${difficulty}</span></div>
                <div style="font-size: 0.9em; color: #666; margin-bottom: 15px;">
                    ${difficulty === 'Easy' ? 'üü¢ Simple preparation, beginner-friendly' : 
                      difficulty === 'Medium' ? 'üü° Requires some cooking skills and attention' : 
                      'üî¥ Complex recipe, experience recommended'}
                </div>
            `;
            
            // Display cost comparison
            const costPercentage = getCostPercentage(cost);
            const costBar = document.getElementById('costBar');
            const costText = document.getElementById('costText');
            
            costBar.className = `cost-fill cost-${cost}`;
            costBar.style.width = `${costPercentage}%`;
            costText.textContent = `${getCostEmoji(cost)} ${capitalizeFirst(cost)}`;
            
            // Show modal
            modal.classList.add('show');
        }

        function getCostPercentage(cost) {
            const costValues = {
                'low': 25,
                'medium': 50,
                'medium-high': 75,
                'high': 100
            };
            return costValues[cost] || 25;
        }

        function closeMealModal() {
            document.getElementById('mealModal').classList.remove('show');
        }

        // Close modal when clicking outside
        document.getElementById('mealModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeMealModal();
            }
        });

        function showGroceryList() {
            if (!currentSchedule) {
                alert('Please generate a schedule first!');
                return;
            }
            
            const groceryList = document.getElementById('groceryList');
            const groceryItems = document.getElementById('groceryItems');
            
            // Hide restaurant list when showing grocery list
            document.getElementById('restaurantList').style.display = 'none';
            
            // Collect all ingredients from current schedule
            const allIngredients = [];
            Object.values(currentSchedule).forEach(meal => {
                const ingredients = groceryDatabase[meal.name] || [];
                allIngredients.push(...ingredients);
            });
            
            // Remove duplicates and sort
            const uniqueIngredients = [...new Set(allIngredients)].sort();
            
            // Clear previous items
            groceryItems.innerHTML = '';
            
            // Add items to list
            uniqueIngredients.forEach(ingredient => {
                const li = document.createElement('li');
                li.textContent = ingredient;
                li.classList.add('fade-in');
                groceryItems.appendChild(li);
            });
            
            // Show grocery list
            groceryList.style.display = 'block';
            
            // Smooth scroll to grocery list
            groceryList.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function randomOrderOut() {
            const restaurant = restaurantOptions[Math.floor(Math.random() * restaurantOptions.length)];
            const restaurantList = document.getElementById('restaurantList');
            const restaurantChoice = document.getElementById('restaurantChoice');
            const restaurantItems = document.getElementById('restaurantItems');
            
            // Hide grocery list when showing restaurant options
            document.getElementById('groceryList').style.display = 'none';
            
            // Update restaurant choice
            restaurantChoice.textContent = `Tonight's pick: ${restaurant.name}! üéâ`;
            
            // Clear previous items
            restaurantItems.innerHTML = '';
            
            // Add menu items
            restaurant.items.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                li.classList.add('fade-in');
                restaurantItems.appendChild(li);
            });
            
            // Show restaurant list
            restaurantList.style.display = 'block';
            
            // Smooth scroll to restaurant list
            restaurantList.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeMealModal();
            } else if (e.key === ' ' || e.key === 'Enter') {
                e.preventDefault();
                generateSchedule();
            } else if (e.key === 'g' || e.key === 'G') {
                e.preventDefault();
                showGroceryList();
            } else if (e.key === 'o' || e.key === 'O') {
                e.preventDefault();
                randomOrderOut();
            }
        });
    </script>
</body>
</html>